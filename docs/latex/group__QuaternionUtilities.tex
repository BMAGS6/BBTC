\doxysection{Quaternion Utilities}
\hypertarget{group__QuaternionUtilities}{}\label{group__QuaternionUtilities}\index{Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structQuat}{Quat}}
\begin{DoxyCompactList}\small\item\em A quaternion representing orientation in 3D, with fields w, x, y, z. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{structQuat}{Quat}} \mbox{\hyperlink{group__QuaternionUtilities_ga7ccd7ee50f9a20b211be6e4ef3f19bfa}{quat\+\_\+derivatives}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q, const double w\mbox{[}3\mbox{]})
\begin{DoxyCompactList}\small\item\em Computes $ \dot{q} = \frac{1}{2} \mathbf{w}_q \cdot q $ for quaternion integration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__QuaternionUtilities_gaf1a2dc4413b04ab6fb4508f147b845b0}{quat\+\_\+normalize}} (\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q)
\begin{DoxyCompactList}\small\item\em Normalize the quaternion in-\/place. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structQuat}{Quat}} \mbox{\hyperlink{group__QuaternionUtilities_gadfcb29fdbc6bb0fed10df905dbe31651}{quat\+\_\+multiply}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q1, const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q2)
\begin{DoxyCompactList}\small\item\em Multiply two quaternions\+: result = q1 \texorpdfstring{$\ast$}{*} q2. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structQuat}{Quat}} \mbox{\hyperlink{group__QuaternionUtilities_ga3673e9e5770d09f6ec241f69f4e2ddeb}{quat\+\_\+conjugate}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q)
\begin{DoxyCompactList}\small\item\em Conjugate of a quaternion\+: $q^* = (w, -x, -y, -z)$. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__QuaternionUtilities_ga032eb9b7eb1d9d251023857aa607b398}{quat\+\_\+rotate\+\_\+vector}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q, const double vect\mbox{[}3\mbox{]}, double out\+Vect\mbox{[}3\mbox{]})
\begin{DoxyCompactList}\small\item\em Rotates a 3D vector using the quaternion {\ttfamily q}. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structQuat}{Quat}} \mbox{\hyperlink{group__QuaternionUtilities_gafaacfb44f8654f8b6061a4978ccb9f52}{quat\+\_\+from\+\_\+axis\+\_\+angle}} (double axis\+\_\+x, double axis\+\_\+y, double axis\+\_\+z, double angle\+Rad)
\begin{DoxyCompactList}\small\item\em Create a pure rotation quaternion from an axis (x,y,z) and an angle (radians). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__QuaternionUtilities_gac3ca94dd79ace3ea9646ca2fb8f4e54f}{quat\+\_\+integrate\+\_\+angular\+\_\+velocity}} (\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q, const double w\mbox{[}3\mbox{]}, double dt)
\begin{DoxyCompactList}\small\item\em Update orientation by angular velocity w (in rad/s) over time dt. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structQuat}{Quat}} \mbox{\hyperlink{group__QuaternionUtilities_ga78f7e17f7b4bb25400a47f61cf2c91c4}{quat\+\_\+add\+\_\+scaled}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}q, const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}dq, double scale)
\begin{DoxyCompactList}\small\item\em Add a scaled quaternion dq to a base quaternion q\+: result = q + scale\texorpdfstring{$\ast$}{*}dq. \end{DoxyCompactList}\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{group__QuaternionUtilities_ga097c312803a73b7069646847b7b2323c}{quat\+\_\+normalize}} (\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict q)
\begin{DoxyCompactList}\small\item\em Normalizes a quaternion to unit length. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structQuat}{Quat}} \mbox{\hyperlink{group__QuaternionUtilities_gaddda0acf384007f7a08c9149df2d385f}{quat\+\_\+conjugate}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict q)
\begin{DoxyCompactList}\small\item\em Computes the conjugate of a quaternion. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__QuaternionUtilities_ga604b65f1323364c16af5997c49cad0d7}{quat\+\_\+rotate\+\_\+vector}} (const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict q, const double vect\mbox{[}3\mbox{]}, double out\+Vect\mbox{[}3\mbox{]})
\begin{DoxyCompactList}\small\item\em Rotates a 3D vector using the quaternion {\ttfamily q}. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__QuaternionUtilities_ga1e032e8892106abaf20bb639af7280fc}{quat\+\_\+integrate\+\_\+angular\+\_\+velocity}} (\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict q, const double w\mbox{[}3\mbox{]}, double dt)
\begin{DoxyCompactList}\small\item\em Integrates quaternion orientation by angular velocity over time dt. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}


\doxysubsection{Function Documentation}
\Hypertarget{group__QuaternionUtilities_ga78f7e17f7b4bb25400a47f61cf2c91c4}\label{group__QuaternionUtilities_ga78f7e17f7b4bb25400a47f61cf2c91c4} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_add\_scaled@{quat\_add\_scaled}}
\index{quat\_add\_scaled@{quat\_add\_scaled}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_add\_scaled()}{quat\_add\_scaled()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structQuat}{Quat}} quat\+\_\+add\+\_\+scaled (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q,  }\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{dq,  }\item[{double}]{scale }\end{DoxyParamCaption})}



Add a scaled quaternion dq to a base quaternion q\+: result = q + scale\texorpdfstring{$\ast$}{*}dq. 


\begin{DoxyParams}{Parameters}
{\em q} & Base quaternion \\
\hline
{\em dq} & Delta quaternion \\
\hline
{\em scale} & Scale factor \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The resulting quaternion
\end{DoxyReturn}
This effectively does\+: $ q \leftarrow q + 0.5\, (0, \omega)\, q \, dt,$ then normalizes the quaternion to unit length.

Typically used in RK4 steps, e.\+g.\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{midState.ori\ =\ \mbox{\hyperlink{group__QuaternionUtilities_ga78f7e17f7b4bb25400a47f61cf2c91c4}{quat\_add\_scaled}}(\&state-\/>ori,\ \&k1.dOri,\ 0.5\ *\ dt);}

\end{DoxyCode}


Add a scaled quaternion dq to a base quaternion q\+: result = q + scale\texorpdfstring{$\ast$}{*}dq. \Hypertarget{group__QuaternionUtilities_ga3673e9e5770d09f6ec241f69f4e2ddeb}\label{group__QuaternionUtilities_ga3673e9e5770d09f6ec241f69f4e2ddeb} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_conjugate@{quat\_conjugate}}
\index{quat\_conjugate@{quat\_conjugate}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_conjugate()}{quat\_conjugate()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{structQuat}{Quat}} quat\+\_\+conjugate (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q }\end{DoxyParamCaption})}



Conjugate of a quaternion\+: $q^* = (w, -x, -y, -z)$. 


\begin{DoxyParams}{Parameters}
{\em q} & The input quaternion \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The conjugate 
\end{DoxyReturn}
\Hypertarget{group__QuaternionUtilities_gaddda0acf384007f7a08c9149df2d385f}\label{group__QuaternionUtilities_gaddda0acf384007f7a08c9149df2d385f} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_conjugate@{quat\_conjugate}}
\index{quat\_conjugate@{quat\_conjugate}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_conjugate()}{quat\_conjugate()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \mbox{\hyperlink{structQuat}{Quat}} quat\+\_\+conjugate (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict}]{q }\end{DoxyParamCaption})}



Computes the conjugate of a quaternion. 


\begin{DoxyParams}{Parameters}
{\em q} & Input quaternion. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Quaternion conjugate $ q^* $ such that $ q^* = (w, -x, -y, -z) $ 
\end{DoxyReturn}
\Hypertarget{group__QuaternionUtilities_ga7ccd7ee50f9a20b211be6e4ef3f19bfa}\label{group__QuaternionUtilities_ga7ccd7ee50f9a20b211be6e4ef3f19bfa} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_derivatives@{quat\_derivatives}}
\index{quat\_derivatives@{quat\_derivatives}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_derivatives()}{quat\_derivatives()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{structQuat}{Quat}} quat\+\_\+derivatives (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q,  }\item[{const double}]{w\mbox{[}3\mbox{]} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Computes $ \dot{q} = \frac{1}{2} \mathbf{w}_q \cdot q $ for quaternion integration. 


\begin{DoxyParams}{Parameters}
{\em q} & Input orientation quaternion \\
\hline
{\em w} & Angular velocity vector in radians per second \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Quaternion derivative $ \dot{q} $ 
\end{DoxyReturn}
\Hypertarget{group__QuaternionUtilities_gafaacfb44f8654f8b6061a4978ccb9f52}\label{group__QuaternionUtilities_gafaacfb44f8654f8b6061a4978ccb9f52} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_from\_axis\_angle@{quat\_from\_axis\_angle}}
\index{quat\_from\_axis\_angle@{quat\_from\_axis\_angle}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_from\_axis\_angle()}{quat\_from\_axis\_angle()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structQuat}{Quat}} quat\+\_\+from\+\_\+axis\+\_\+angle (\begin{DoxyParamCaption}\item[{double}]{axis\+\_\+x,  }\item[{double}]{axis\+\_\+y,  }\item[{double}]{axis\+\_\+z,  }\item[{double}]{angle\+Rad }\end{DoxyParamCaption})}



Create a pure rotation quaternion from an axis (x,y,z) and an angle (radians). 


\begin{DoxyParams}{Parameters}
{\em axis\+\_\+x} & X component of axis \\
\hline
{\em axis\+\_\+y} & Y component of axis \\
\hline
{\em axis\+\_\+z} & Z component of axis \\
\hline
{\em angle\+Rad} & Rotation angle in radians \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The resulting quaternion
\end{DoxyReturn}
Create a pure rotation quaternion from an axis (x,y,z) and an angle (radians).


\begin{DoxyParams}{Parameters}
{\em axis} & Rotation axis (unit vector). \\
\hline
{\em angle} & Rotation angle in radians. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Quaternion representing the rotation. 
\end{DoxyReturn}
\Hypertarget{group__QuaternionUtilities_gac3ca94dd79ace3ea9646ca2fb8f4e54f}\label{group__QuaternionUtilities_gac3ca94dd79ace3ea9646ca2fb8f4e54f} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_integrate\_angular\_velocity@{quat\_integrate\_angular\_velocity}}
\index{quat\_integrate\_angular\_velocity@{quat\_integrate\_angular\_velocity}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_integrate\_angular\_velocity()}{quat\_integrate\_angular\_velocity()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void quat\+\_\+integrate\+\_\+angular\+\_\+velocity (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q,  }\item[{const double}]{w\mbox{[}3\mbox{]},  }\item[{double}]{dt }\end{DoxyParamCaption})}



Update orientation by angular velocity w (in rad/s) over time dt. 

This uses dq/dt = 0.\+5 \texorpdfstring{$\ast$}{*} (0, w) \texorpdfstring{$\ast$}{*} q, then normalizes q. 
\begin{DoxyParams}{Parameters}
{\em q} & Pointer to the quaternion \\
\hline
{\em w} & The angular velocity (3D) \\
\hline
{\em dt} & The small time step \\
\hline
\end{DoxyParams}
\Hypertarget{group__QuaternionUtilities_ga1e032e8892106abaf20bb639af7280fc}\label{group__QuaternionUtilities_ga1e032e8892106abaf20bb639af7280fc} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_integrate\_angular\_velocity@{quat\_integrate\_angular\_velocity}}
\index{quat\_integrate\_angular\_velocity@{quat\_integrate\_angular\_velocity}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_integrate\_angular\_velocity()}{quat\_integrate\_angular\_velocity()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void quat\+\_\+integrate\+\_\+angular\+\_\+velocity (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict}]{q,  }\item[{const double}]{w\mbox{[}3\mbox{]},  }\item[{double}]{dt }\end{DoxyParamCaption})}



Integrates quaternion orientation by angular velocity over time dt. 

\Hypertarget{group__QuaternionUtilities_gadfcb29fdbc6bb0fed10df905dbe31651}\label{group__QuaternionUtilities_gadfcb29fdbc6bb0fed10df905dbe31651} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_multiply@{quat\_multiply}}
\index{quat\_multiply@{quat\_multiply}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_multiply()}{quat\_multiply()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structQuat}{Quat}} quat\+\_\+multiply (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q1,  }\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q2 }\end{DoxyParamCaption})}



Multiply two quaternions\+: result = q1 \texorpdfstring{$\ast$}{*} q2. 


\begin{DoxyParams}{Parameters}
{\em q1} & First quaternion \\
\hline
{\em q2} & Second quaternion \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The product quaternion
\end{DoxyReturn}
Multiply two quaternions\+: result = q1 \texorpdfstring{$\ast$}{*} q2.

This performs Hamilton product\+: $ q = q_1 \cdot q_2 $


\begin{DoxyParams}{Parameters}
{\em a} & First quaternion (left-\/hand operand). \\
\hline
{\em b} & Second quaternion (right-\/hand operand). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Result of quaternion multiplication. 
\end{DoxyReturn}
\Hypertarget{group__QuaternionUtilities_gaf1a2dc4413b04ab6fb4508f147b845b0}\label{group__QuaternionUtilities_gaf1a2dc4413b04ab6fb4508f147b845b0} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_normalize@{quat\_normalize}}
\index{quat\_normalize@{quat\_normalize}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_normalize()}{quat\_normalize()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void quat\+\_\+normalize (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q }\end{DoxyParamCaption})}



Normalize the quaternion in-\/place. 

Ensures $q.w^2 + q.x^2 + q.y^2 + q.z^2 = 1$. 
\begin{DoxyParams}{Parameters}
{\em q} & Pointer to the quaternion. \\
\hline
\end{DoxyParams}
\Hypertarget{group__QuaternionUtilities_ga097c312803a73b7069646847b7b2323c}\label{group__QuaternionUtilities_ga097c312803a73b7069646847b7b2323c} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_normalize@{quat\_normalize}}
\index{quat\_normalize@{quat\_normalize}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_normalize()}{quat\_normalize()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void quat\+\_\+normalize (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict}]{q }\end{DoxyParamCaption})}



Normalizes a quaternion to unit length. 


\begin{DoxyParams}{Parameters}
{\em q} & Quaternion to normalize (modified in place). \\
\hline
\end{DoxyParams}
\Hypertarget{group__QuaternionUtilities_ga032eb9b7eb1d9d251023857aa607b398}\label{group__QuaternionUtilities_ga032eb9b7eb1d9d251023857aa607b398} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_rotate\_vector@{quat\_rotate\_vector}}
\index{quat\_rotate\_vector@{quat\_rotate\_vector}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_rotate\_vector()}{quat\_rotate\_vector()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void quat\+\_\+rotate\+\_\+vector (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}}]{q,  }\item[{const double}]{vect\mbox{[}3\mbox{]},  }\item[{double}]{out\+Vect\mbox{[}3\mbox{]} }\end{DoxyParamCaption})}



Rotates a 3D vector using the quaternion {\ttfamily q}. 


\begin{DoxyParams}{Parameters}
{\em q} & Rotation quaternion \\
\hline
{\em vect} & The input vector (x,y,z) \\
\hline
{\em out\+Vect} & The rotated vector (x,y,z)\\
\hline
\end{DoxyParams}
This uses an optimized formula for quaternion \texorpdfstring{$\ast$}{*} vect multiplication\+:  \[
  \mathbf{v}_{out} = \mathbf{v} + 2.0 \Bigl( q_w (\mathbf{q}_v \times \mathbf{v}) 
        + \mathbf{q}_v \times ( \mathbf{q}_v \times \mathbf{v} ) \Bigr).
\] \Hypertarget{group__QuaternionUtilities_ga604b65f1323364c16af5997c49cad0d7}\label{group__QuaternionUtilities_ga604b65f1323364c16af5997c49cad0d7} 
\index{Quaternion Utilities@{Quaternion Utilities}!quat\_rotate\_vector@{quat\_rotate\_vector}}
\index{quat\_rotate\_vector@{quat\_rotate\_vector}!Quaternion Utilities@{Quaternion Utilities}}
\doxysubsubsection{\texorpdfstring{quat\_rotate\_vector()}{quat\_rotate\_vector()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void quat\+\_\+rotate\+\_\+vector (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structQuat}{Quat}} \texorpdfstring{$\ast$}{*}restrict}]{q,  }\item[{const double}]{vect\mbox{[}3\mbox{]},  }\item[{double}]{out\+Vect\mbox{[}3\mbox{]} }\end{DoxyParamCaption})}



Rotates a 3D vector using the quaternion {\ttfamily q}. 

